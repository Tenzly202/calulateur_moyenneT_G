<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Moyenne – Côte d'Ivoire</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100">

    <!-- Container principal -->
    <div class="max-w-3xl mx-auto mt-10 bg-white shadow-xl rounded-xl p-8">

        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">
            Calculateur de Moyenne – Système Ivoirien
        </h1>

        <!-- Formulaire -->
        <form method="POST" action="/calcul" class="space-y-6">

            <!-- Sélection de la classe -->
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Choisir la classe :</label>

                <select id="classe" name="classe"
                        class="w-full border rounded-lg p-3 text-gray-700 shadow-sm"
                        onchange="updateFields()" required>
                    <option value="">Sélectionner…</option>

                    <!-- Automatique via Flask -->
                    {% for cl in coeffs.keys() %}
                        <option value="{{ cl }}" 
                            {% if selected_classe == cl %}selected{% endif %}>
                            {{ cl }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Champs des matières -->
            <div id="notesContainer" class="space-y-4">
                {% for matiere in matieres %}
                <div class="note-field">
                    <label class="block text-gray-700 font-medium">{{ matiere }}</label>
                    <input type="number" step="0.01" name="notes"
                           value="{{ notes[loop.index0] if notes else '' }}"
                           class="w-full p-3 border rounded-lg shadow-sm focus:ring focus:ring-blue-300">
                </div>
                {% endfor %}
            </div>

            <!-- Bouton -->
            <button class="w-full bg-blue-600 text-white font-semibold rounded-lg p-3 shadow-md hover:bg-blue-700 transition">
                Calculer la moyenne
            </button>
        </form>

        <!-- Résultat -->
        {% if result %}
        <div class="mt-6 bg-blue-50 border-l-4 border-blue-600 p-5 rounded-lg text-center">
            <p class="text-xl font-semibold text-blue-700">
                Moyenne : {{ result }}
            </p>
        </div>
        {% endif %}

    </div>


    <!-- Script -->
    <script>
        function updateFields() {
            const classe = document.getElementById("classe").value;

            fetch(`/get_coeffs?classe=${classe}`)
                .then(response => response.json())
                .then(data => {
                    const coeffs = data.coeffs;
                    const fields = document.querySelectorAll(".note-field");

                    fields.forEach((field, index) => {
                        field.style.display = coeffs[index] === 0 ? "none" : "block";
                    });
                });
        }

        // Exécuter automatiquement après chargement (pour édition)
        updateFields();
    </script>

</body>
</html>
